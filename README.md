# AgentFlow v2

AgentFlow v2 is a modular Electron desktop application that helps marketers plan and produce campaigns across text, image, and video formats. A central **MasterAgent** dynamically builds DAG plans, coordinates specialized agents, and records every artifact, log, and run in SQLite.

## Features

- **Dynamic planning** – MasterAgent generates task DAGs with retries, Guard validation, and HumanGate fallbacks.
- **Modular agents** – Writer, Image, Video, Guard, HumanGate, Uploader, and Diagnostic agents loaded from manifests.
- **Provider management** – Priority-based fallback across OpenAI/Stability/local providers with mock mode.
- **Desktop UI** – Electron + React + Tailwind flows for the campaign wizard, plan preview, execution progress, results, and settings.
- **SQLite storage** – Tasks, runs, artifacts, logs, and providers with migrations and seeds.
- **CLI tooling** – Scripts for migrations, orchestration, verification, and seeding.
- **Testing** – Vitest unit + integration suites (Playwright hooks ready for e2e).

## Getting Started

1. **Install dependencies**
   ```bash
   npm install
   ```
   > ⚠️ Run installation commands from the repository root (`AgentFlow/`).
   > The legacy `app/` package is kept for reference and does not install the
   > renderer dependencies automatically.
2. **Prepare the database**
   ```bash
   npm run migrate
   npm run seeds
   ```
3. **Run in development**
   ```bash
   npm run dev
   ```
   This starts both the Electron main process and the Vite renderer.

4. **Execute a mock campaign**
   ```bash
   npm run orchestrate "Spring launch" text,image,video
   ```
5. **Run tests**
   ```bash
   npm run test
   ```

### Troubleshooting startup issues

- **"Failed to load PostCSS plugin" errors** – Run `npm install` from the
  repository root (`AgentFlow/`). This installs both `tailwindcss` and
  `autoprefixer` which are required by the shared `postcss.config.cjs`. If you
  previously ran `npm install` from `app/` or `app/renderer/`, remove those
  `node_modules` folders and reinstall from the root before retrying `npm run dev`.
- **Electron window does not appear** – Ensure the `npm run dev` command stays
  running; closing the terminal stops the Electron process. The renderer UI will
  be available at `http://localhost:5173/` while the command is active.

## Project Layout

```
app/
  agents/          # Agent manifests and implementations
  core/            # MasterAgent, provider manager, repositories, storage
  ui/              # React components, pages, styles, entrypoints
  config/          # Provider and validation configuration
  db/              # SQLite migrations and seeds
  data/            # Runtime database, artifacts, published assets
  main/            # Electron main process entry
  preload/         # Preload script exposing safe APIs
scripts/           # CLI utilities (migrate, orchestrate, seeds, verify)
tests/             # Vitest unit & integration suites
docs/              # Developer guides, API docs, changelog
```

## CLI Overview

- `npm run migrate` – apply SQLite migrations
- `npm run seeds` – seed default providers
- `npm run orchestrate` – create and execute a campaign task
- `npm run verify` – run diagnostics and produce `docs/VerificationReport.md`

## UI Flows

The renderer exposes:
- **Wizard** – capture campaign title, goals, tone, and desired content types.
- **Plan Preview** – visualize the DAG and continue to execution.
- **Progress** – monitor node status, retries, and logs.
- **Results** – review generated text, image thumbnails, and video mockups.
- **Settings** – manage mock mode, localization (ru/en), and approval toggles.

## Documentation

- `docs/DeveloperGuide.md`
- `docs/API.md`
- `docs/CHANGELOG.md`
- `docs/VerificationReport.md` (generated by DiagnosticAgent)

## License

MIT
